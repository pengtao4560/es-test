SpringCloud Alibaba
Nacos服务注册和配置中心
	Nacos简介
#####为什么叫Nacos
			前四个字母分别为Naming和Configuration的前两个字母，最后的s为Service。
##### nacos是什么: 一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。
			Nacos: Dynamic Naming and Configuration Service
			Nacos就是注册中心 + 配置中心的组合
				等价于
					Nacos = Eureka+Config +Bus
##### nacos能干嘛
			替代Eureka做服务注册中心
			替代Config做服务配置中心
##### nacos去哪下
[](https://github.com/alibaba/Nacos)
[官网文档](https://nacos.io/zh-cn/docs/what-is-nacos.html)
[](https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_discovery
)				
		各种注册中心比较
	安装并运行Nacos
		本地Java8+Maven环境已经OK
[先从官网下载Nacos](https://github.com/alibaba/nacos/releases)
解压安装包，直接运行bin目录下的startup.cmd
		单机版启动命令：
		startup.cmd -m standalone
		[命令运行成功后直接访问](http://localhost:8848/nacos)
			默认账号密码都是nacos
		结果页面
	Nacos作为服务注册中心演示
[官网文档](https://spring-cloud-alibaba-group.github.io/github-pages/greenwich/spring-cloud-alibaba.html#_spring_cloud_alibaba_nacos_config)
			
		基于Nacos的服务提供者
			新建Module
				cloudalibaba-provider-payment9001
			POM
				父POM
				本模块POM
			YML
			主启动
			业务类
			测试
				http://localhost:9001/payment/nacos/1
				nacos控制台
				nacos服务注册中心+服务提供者9001都OK了
			为了下一章节演示nacos的负载均衡，参照9001新建9002
				新建cloudalibaba-provider-payment9002
				9002其它步骤你懂的
				或者取巧不想新建重复体力劳动，直接拷贝虚拟端口映射
		基于Nacos的服务消费者
			新建Module
				cloudalibaba-consumer-nacos-order83
			POM
				为什么nacos支持负载均衡
			YML
			主启动
			业务类
				ApplicationContextBean
				OrderNacosController
			测试
				nacos控制台
				http://localhost:83/consumer/payment/nacos/13
					83访问9001/9002，轮询负载OK
		服务注册中心对比
			各种注册中心对比
				Nacos全景图所示
				Nacos和CAP
				切换
					Nacos 支持AP和CP模式的切换
	Nacos作为服务配置中心演示
		Nacos作为配置中心-基础配置
			cloudalibaba-config-nacos-client3377
			POM
			YML
				why配置两个
				YML
					bootstrap
					application
			主启动
			业务类
				ConfigClientController
				@RefreshScope
			在Nacos中添加配置信息
				Nacos中的匹配规则
					理论
						Nacos中的dataid的组成格式及与SpringBoot配置文件中的匹配规则
						官网
					实操
						配置新增
						Nacos界面配置对应
							设置DataId
								公式：
									${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}
								prefix 默认为 spring.application.name 的值
								spring.profile.active 即为当前环境对应的 profile，可以通过配置项 spring.profile.active 来配置。
								file-exetension 为配置内容的数据格式，可以通过配置项 spring.cloud.nacos.config.file-extension 来配置
								小总结说明
						历史配置
							Nacos会记录配置文件的历史版本默认保留30天，此外还有一键回滚功能，回滚操作将会触发配置更新
							回滚
			测试
				启动前需要在nacos客户端-配置管理-配置管理栏目下有对应的yaml配置文件
				运行cloud-config-nacos-client3377的主启动类
				调用接口查看配置信息
					http://localhost:3377/config/info
			自带动态刷新
				修改下Nacos中的yaml配置文件，再次调用查看配置的接口，就会发现配置已经刷新
		Nacos作为配置中心-分类配置
			问题
				多环境多项目管理
			Nacos的图形化管理界面
				配置管理
				命名空间
			Namespace+Group+Data ID三者关系？为什么这么设计？
			Case
				三种方案加载配置
					DataID方案
						指定spring.profile.active和配置文件的DataID来使不同环境下读取不同的配置
						默认空间+默认分组+新建dev和test两个DataID
							新建dev配置DataID
							新建test配置DataID
						通过spring.profile.active属性就能进行多环境下配置文件的读取
						测试
							http://localhost:3377/config/info
							配置是什么就加载什么
								test
					Group方案
						通过Group实现环境区分
							新建Group
						在nacos图形界面控制台上面新建配置文件DataID
						bootstrap+application
							在config下增加一条group的配置即可。
可配置为DEV_GROUP或TEST_GROUP
					Namespace方案
						新建dev/test的Namespace
						回到服务管理-服务列表查看
						按照域名配置填写
						YML
							bootstrap
							application
	Nacos集群和持久化配置（重要）
		官网说明
			https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html
			官网架构图(写的o(╥﹏╥)o)
			上图官网翻译，真实情况
			说明
				按照上述，我们需要mysql数据库
				官网说明
					https://nacos.io/zh-cn/docs/deployment.html
					重点说明
		Nacos持久化配置解释
			Nacos默认自带的是嵌入式数据库derby
				https://github.com/alibaba/nacos/blob/develop/config/pom.xml
			derby到mysql切换配置步骤
				nacos-server-1.1.4\nacos\conf目录下找到sql脚本
					nacos-mysql.sql
					执行脚本
				nacos-server-1.1.4\nacos\conf目录下找到application.properties
			启动Nacos，可以看到是个全新的空记录界面，以前是记录进derby
		Linux版Nacos+MySQL生产环境配置
			预计需要，1个Nginx+3个nacos注册中心+1个mysql
			Nacos下载Linux版
				https://github.com/alibaba/nacos/releases/tag/1.1.4
				nacos-server-1.1.4.tar.gz
				解压后安装
			集群配置步骤(重点)
				Linux服务器上mysql数据库配置
					SQL脚本在哪里
					sql语句源文件
						nacos-mysql.sql
					自己Linux机器上的Mysql数据库粘贴
						执行后结果
				application.properties 配置
					位置
					内容
				Linux服务器上nacos的集群配置cluster.conf
					梳理出3台nacos集器的不同服务端口号
					复制出cluster.conf
					内容
						这个IP不能写127.0.0.1，必须是
Linux命令hostname -i能够识别的IP
				编辑Nacos的启动脚本startup.sh，使它能够接受不同的启动端口
					/mynacos/nacos/bin 目录下有startup.sh
					在什么地方，修改什么，怎么修改
					思考
					修改内容
					执行方式
				Nginx的配置，由它作为负载均衡器
					修改nginx的配置文件
					nginx.conf
					按照指定启动
				截止到此处，1个Nginx+3个nacos注册中心+1个mysql
					测试通过nginx访问nacos
						http://192.168.111.144:1111/nacos/#/login
					新建一个配置测试
					linux服务器的mysql插入一条记录
			测试
				微服务cloudalibaba-provider-payment9002启动注册进nacos集群
					yml
					结果
			高可用小总结
